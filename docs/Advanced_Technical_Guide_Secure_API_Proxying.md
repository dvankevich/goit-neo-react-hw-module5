# üìò –†–æ–∑—à–∏—Ä–µ–Ω–∞ —Ç–µ—Ö–Ω—ñ—á–Ω–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è: –ë–µ–∑–ø–µ—á–Ω–µ –ø—Ä–æ–∫—Å—ñ—é–≤–∞–Ω–Ω—è API

## –ö–æ–Ω—Ü–µ–ø—Ü—ñ—è –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏

–£ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—Ö React-–¥–æ–¥–∞—Ç–∫–∞—Ö (SPA) –∑–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è –∑ –ø—Ä–µ—Ñ—ñ–∫—Å–æ–º `VITE_` –≤—à–∏–≤–∞—é—Ç—å—Å—è –≤ –∫–æ–¥. –ë—É–¥—å-—Ö—Ç–æ –º–æ–∂–µ –≤—ñ–¥–∫—Ä–∏—Ç–∏ –≤–∫–ª–∞–¥–∫—É **Sources** —É –±—Ä–∞—É–∑–µ—Ä—ñ —Ç–∞ –∑–Ω–∞–π—Ç–∏ –≤–∞—à –∫–ª—é—á.
–ú–∏ –≤–∏—Ä—ñ—à–∏–ª–∏ —Ü—é –ø—Ä–æ–±–ª–µ–º—É, —Å—Ç–≤–æ—Ä–∏–≤—à–∏ "—à–ª—é–∑" (Serverless Function). –¢–µ–ø–µ—Ä —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–µ –∑–Ω–∞—î –∫–ª—é—á–∞ TMDB ‚Äî –≤—ñ–Ω –∑–Ω–∞—î –ª–∏—à–µ –∞–¥—Ä–µ—Å—É –Ω–∞—à–æ–≥–æ —à–ª—é–∑—É.

---

## 1. –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –º–∞—Ä—à—Ä—É—Ç—ñ–≤ (`vercel.json`)

–¶–µ–π —Ñ–∞–π–ª ‚Äî —Ü–µ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞ Vercel, —è–∫ –ø–æ–≤–æ–¥–∏—Ç–∏—Å—è –∑ –≤—Ö—ñ–¥–Ω–∏–º —Ç—Ä–∞—Ñ—ñ–∫–æ–º.

```json
{
  "cleanUrls": true,
  "rewrites": [
    {
      "source": "/api/:path*",
      "destination": "/api/:path*"
    },
    {
      "source": "/((?!api/|src/|node_modules/|@vite/|@react-refresh|index\\.html|.*\\.).*)",
      "destination": "/index.html"
    }
  ]
}

```

* **–ü–µ—Ä—à–∏–π `rewrite**`: –ö–∞–∂–µ, —â–æ –≤—Å–µ, —â–æ –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –∑ `/api/`, ‚Äî —Ü–µ –Ω–∞—à—ñ —Å–µ—Ä–≤–µ—Ä–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó.
* **–î—Ä—É–≥–∏–π `rewrite**`: –¶–µ –∑–∞—Ö–∏—Å—Ç –≤—ñ–¥ –ø–æ–º–∏–ª–∫–∏ 404 –ø—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏. –ú–∏ –∫–∞–∂–µ–º–æ: "–Ø–∫—â–æ –∑–∞–ø–∏—Ç –Ω–µ —Å—Ç–æ—Å—É—î—Ç—å—Å—è API –∞–±–æ —Ç–µ—Ö–Ω—ñ—á–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ Vite ‚Äî –≤—ñ–¥–¥–∞–π `index.html`". –¶–µ –¥–æ–∑–≤–æ–ª—è—î React Router —Å–∞–º–æ—Å—Ç—ñ–π–Ω–æ –æ–±—Ä–æ–±–ª—è—Ç–∏ URL —Ç–∏–ø—É `/movies/123`.

---

## 2. –õ–æ–≥—ñ–∫–∞ —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ —à–ª—é–∑—É (`api/movies.js`)

–¶–µ Node.js —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ. –¢—É—Ç –º–∏ —Ä–µ–∞–ª—ñ–∑—É–≤–∞–ª–∏ —Ç—Ä–∏ —Ä—ñ–≤–Ω—ñ –∑–∞—Ö–∏—Å—Ç—É.

```javascript
import axios from "axios";

export default async function handler(req, res) {
  // –í–∏—Ç—è–≥—É—î–º–æ —à–ª—è—Ö (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, trending/movie/day) —Ç–∞ —ñ–Ω—à—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ (query, page)
  const { path, ...queryParams } = req.query;
  const API_KEY = process.env.TMDB_TOKEN;
  const EXPECTED_SECRET = process.env.INTERNAL_APP_SECRET;

  // –†—ñ–≤–µ–Ω—å 1: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ "—Å–≤—ñ–π/—á—É–∂–∏–π" —á–µ—Ä–µ–∑ –∫–∞—Å—Ç–æ–º–Ω–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫
  if (req.headers["x-app-usage-token"] !== EXPECTED_SECRET) {
    return res.status(403).json({ error: "Access denied" });
  }

  // –†—ñ–≤–µ–Ω—å 2: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–∂–µ—Ä–µ–ª–∞ –∑–∞–ø–∏—Ç—É (Referer)
  if (process.env.NODE_ENV === "production") {
    const referer = req.headers.referer || "";
    const isVercel = referer.includes("goit-neo-react-hw-module5") && referer.includes(".vercel.app");
    const isLocal = referer.includes("localhost");

    if (!isVercel && !isLocal) {
      return res.status(403).json({ error: "Unauthorized origin" });
    }
  }

  // –†—ñ–≤–µ–Ω—å 3: –ë–µ–∑–ø–µ—á–Ω–∏–π –∑–∞–ø–∏—Ç –¥–æ —Å—Ç–æ—Ä–æ–Ω–Ω—å–æ–≥–æ API
  try {
    const response = await axios.get(`https://api.themoviedb.org/3/${path}`, {
      headers: {
        Authorization: `Bearer ${API_KEY}`, // –ö–ª—é—á –¥–æ–¥–∞—î—Ç—å—Å—è —Ç—É—Ç, –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ
        accept: "application/json",
      },
      params: { language: "en-US", ...queryParams },
    });
    return res.status(200).json(response.data);
  } catch (error) {
    return res.status(error.response?.status || 500).json({ message: error.message });
  }
}

```

---

## 3. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–ª—ñ—î–Ω—Ç—Å—å–∫–æ—ó —á–∞—Å—Ç–∏–Ω–∏ (`src/api/tmdb-api.js`)

–ù–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—ñ –º–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ `axios` —ñ–Ω—Å—Ç–∞–Ω—Å, —è–∫–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –¥–æ–¥–∞—î –Ω–∞—à –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π "–ø–∞—Ä–æ–ª—å".

```javascript
import axios from "axios";

const api = axios.create({
  baseURL: "/api",
  headers: {
    // –¶—è –∑–º—ñ–Ω–Ω–∞ –ø—Ä–æ–ø–∏—Å—É—î—Ç—å—Å—è –≤ Vercel Dashboard —è–∫ VITE_INTERNAL_APP_SECRET
    "x-app-usage-token": import.meta.env.VITE_INTERNAL_APP_SECRET
  }
});

// –£–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏–π –º–µ—Ç–æ–¥: –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è –±—É–¥—å-—è–∫–æ–≥–æ –∑–∞–ø–∏—Ç—É –¥–æ TMDB
const fetchFromProxy = async (tmdbPath, params = {}) => {
  const response = await api.get("/movies", {
    params: { path: tmdbPath, ...params },
  });
  return response.data;
};

```

---

## 4. –ö–µ—Ä—É–≤–∞–Ω–Ω—è —Å–µ–∫—Ä–µ—Ç–∞–º–∏ —Ç–∞ –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ CLI

–ù–∞–π–≤–∞–∂–ª–∏–≤—ñ—à–∏–π –µ—Ç–∞–ø ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –∑ —Ö–º–∞—Ä–æ—é.

### –ü–æ–∫—Ä–æ–∫–æ–≤–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º –¥–µ–ø–ª–æ—é:

1. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è**: –í–∏–∫–æ–Ω–∞–π—Ç–µ `vercel login`. –¶–µ –∑–≤'—è–∂–µ –≤–∞—à —Ç–µ—Ä–º—ñ–Ω–∞–ª –∑ –∞–∫–∞—É–Ω—Ç–æ–º Vercel.
2. **–ó–≤'—è–∑–æ–∫**: –í–∏–∫–æ–Ω–∞–π—Ç–µ `vercel link`. –¶–µ —Å—Ç–≤–æ—Ä–∏—Ç—å –ø–∞–ø–∫—É `.vercel`, –¥–µ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è ID –≤–∞—à–æ–≥–æ –ø—Ä–æ—î–∫—Ç—É.
3. **–°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∑–º—ñ–Ω–Ω–∏—Ö**:
* –î–æ–¥–∞–π—Ç–µ –∑–º—ñ–Ω–Ω—ñ –Ω–∞ —Å–∞–π—Ç—ñ Vercel (Settings -> Environment Variables).
* –í–∏–∫–æ–Ω–∞–π—Ç–µ `vercel env pull .env.local` ‚Äî —Ü–µ –±–µ–∑–ø–µ—á–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç—å —ó—Ö –Ω–∞ –≤–∞—à –∫–æ–º–ø'—é—Ç–µ—Ä.


4. **–õ–æ–∫–∞–ª—å–Ω–∞ —Ä–æ–∑—Ä–æ–±–∫–∞**: –ó–∞–ø—É—Å—Ç—ñ—Ç—å `vercel dev`. CLI –ø—ñ–¥–Ω—ñ–º–µ –ª–æ–∫–∞–ª—å–Ω–∏–π —Å–µ—Ä–≤–µ—Ä, —è–∫–∏–π –ø—ñ–¥—Ç—Ä–∏–º—É—î –ø–∞–ø–∫—É `api/`.
5. **–ü—É–±–ª—ñ–∫–∞—Ü—ñ—è**:
* –î–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥—ñ–ª–∫–∏: `git push origin your-branch-name`.
* –î–ª—è —Ñ—ñ–Ω–∞–ª—å–Ω–æ–≥–æ —Ä–µ–ª—ñ–∑—É: `vercel --prod`.



---

## –ß–æ–º—É —Ü–µ —Ä—ñ—à–µ–Ω–Ω—è –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–µ?

* **–°–µ–∫—Ä–µ—Ç–Ω—ñ—Å—Ç—å**: –í–∞—à TMDB —Ç–æ–∫–µ–Ω –Ω–∞–¥—ñ–π–Ω–æ —Å—Ö–æ–≤–∞–Ω–∏–π. –ù–∞–≤—ñ—Ç—å —è–∫—â–æ —Ö–∞–∫–µ—Ä –≤–∫—Ä–∞–¥–µ –≤–µ—Å—å –≤–∞—à —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥-–∫–æ–¥, –≤—ñ–Ω –Ω–µ –æ—Ç—Ä–∏–º–∞—î –∫–ª—é—á.
* **–ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å**: –í–∏ –º–æ–∂–µ—Ç–µ –ª–µ–≥–∫–æ –¥–æ–¥–∞—Ç–∏ –Ω–æ–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `api/users.js`), –ø—Ä–æ—Å—Ç–æ —Å—Ç–≤–æ—Ä–∏–≤—à–∏ –Ω–æ–≤–∏–π —Ñ–∞–π–ª —É –ø–∞–ø—Ü—ñ `api`.
* **–ì–Ω—É—á–∫—ñ—Å—Ç—å**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ "—É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏–π —à–ª—è—Ö" (`path`), –≤–∏ –Ω–µ –¥—É–±–ª—é—î—Ç–µ –∫–æ–¥ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –æ–∫—Ä–µ–º–æ–≥–æ –∑–∞–ø–∏—Ç—É (—Ñ—ñ–ª—å–º–∏, –ø–æ—à—É–∫, –∞–∫—Ç–æ—Ä–∏).
